<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>web player test</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="assets/css/bootstrap.css" rel="stylesheet">
    <style type="text/css">
      body {
        padding-top: 60px;
        padding-bottom: 40px;
        overflow:hidden;
      }
      .sidebar-nav {
        padding: 9px 0;
      }

      @media (max-width: 980px) {
        /* Enable use of floated navbar text */
        .navbar-text.pull-right {
          float: none;
          padding-left: 5px;
          padding-right: 5px;
        }
      }
    </style>
    <link href="assets/css/bootstrap-responsive.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="assets/js/html5shiv.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="assets/ico/apple-touch-icon-57-precomposed.png">
    <link rel="shortcut icon" href="assets/ico/favicon.png">
  </head>

  <body>
    <input type="button"  value="add page and slider" id="addSliderBtn" />
    <div class="container-fluid" style="width:800px; height:500px; margin:0 auto; background-color:black;">  
      <div id="main_div" style="position:relative">

      </div>
     
<!--  
       <div class="row-fluid" style="background-color:green;float:left; position:relative;">page 1</div>    
      <div class="row-fluid" style="background-color:red;float:left; position:relative; top:-20px; left:-100px;">page 2</div>
      <div class="row-fluid" style="background-color:grey;float:left; position:relative; top:-40px; left:-50px;">page 3</div>
      <div class="row-fluid" style="background-color:yellow;float:left; position:relative; top:-60px;">page 4</div>
-->

    </div>
    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="assets/js/jquery.js"></script>
    <script src="assets/js/bootstrap-transition.js"></script>
    <script src="assets/js/bootstrap-alert.js"></script>
    <script src="assets/js/bootstrap-modal.js"></script>
    <script src="assets/js/bootstrap-dropdown.js"></script>
    <script src="assets/js/bootstrap-scrollspy.js"></script>
    <script src="assets/js/bootstrap-tab.js"></script>
    <script src="assets/js/bootstrap-tooltip.js"></script>
    <script src="assets/js/bootstrap-popover.js"></script>
    <script src="assets/js/bootstrap-button.js"></script>
    <script src="assets/js/bootstrap-collapse.js"></script>
    <script src="assets/js/bootstrap-carousel.js"></script>
    <script src="assets/js/bootstrap-typeahead.js"></script>

  </body>
</html>

<script type="text/javascript">
$(document).ready(function() {
  var base = {
      current_idx : 0,
      show_width: 150,
      each_height: 20,
      move_dis:1000,
      speed:500,
      pages: [],
      add_page : function(container){

        var page_info = {
            id :  base.current_idx,
            name : 'page'+base.current_idx,
            top : 0,
            left : 0,
            next_id: (base.current_idx+1),
            color : 'rgb('
                  + (Math.floor(Math.random() * 256)) + ','
                  + (Math.floor(Math.random() * 256)) + ','
                  + (Math.floor(Math.random() * 256)) + ')'

        }
        
        // 新增page
        var new_page = $('<div></div>').attr("class", 'row-fluid')
                                       .attr("id", page_info.name)
                                       .css('background-color', page_info.color)
                                       .css('position', 'absolute')
                                       .css('top', page_info.top+'px')
                                       .html('page'+(this.current_idx))
                                       .click(function(){
                                          
                                          // 有上一層才刪除
                                          if($('#page'+page_info.next_id).length>0)
                                          {
                                            // 移除前一個
                                             $('#page'+page_info.next_id).animate({
                                                left: "+="+(base.move_dis-base.show_width)
                                              }, base.speed, function() {
                                                   $('#page'+page_info.next_id).remove();                                                  
                                              });


                                              base.pages.splice((base.current_idx-1),1); 
                                              base.current_idx --;

                                              if(base.pages.length>1)
                                              {
                                                  // 位置設定完移動主框架
                                                  $("#"+container).animate({
                                                      left: "+="+base.show_width,
                                                    }, base.speed, function() {
                                                    // Animation complete.
                                                   
                                                  });                                                

                                              }
                                          }
                                       });

        // 將新頁資訊紀錄
        this.pages.push(page_info);


        $(new_page).appendTo('#'+container);
        if(this.pages.length>1)
        {
          console.log(page_info.name);
          $("#"+page_info.name).css('left', ((base.move_dis-base.show_width)+ (base.show_width*base.current_idx))+'px');
        }
          

        // 調整之前page位置
        for(var i = 0; i < base.pages.length; i++){

            var control_obj = $("#"+base.pages[i].name);

            if(base.pages.length==1)
            {

            }
            else if(base.pages.length==2)
            {
              if(i==1)
              {

                control_obj.animate({
                    left: "-="+(base.move_dis-base.show_width),
                  }, base.speed, function() {
                  // Animation complete.
                 
                });                
              }

            }
            else
            {
              if(i==(base.pages.length-1))
              {
                control_obj.animate({
                    left: "-="+(base.move_dis-base.show_width)
                  }, base.speed, function() {
                  // Animation complete.
                                 
                });
              }
              else{
                 control_obj.css('left', base.show_width*i);
              } 
            }
        }  

        if(base.pages.length>2)
        {

          // 位置設定完移動主框架
          $("#"+container).animate({
              left: "-="+base.show_width,
            }, base.speed, function() {
            // Animation complete.
           
          });
         
        }

        this.current_idx++;
      }
  }
  $("#addSliderBtn").click(function(){
     base.add_page('main_div');
  });

});
</script>
